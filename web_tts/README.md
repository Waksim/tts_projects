# Web TTS - –í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –æ–∑–≤—É—á–∏–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞

–ü—Ä–æ—Å—Ç–æ–µ –∏ –∫—Ä–∞—Å–∏–≤–æ–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Å–∏–Ω—Ç–µ–∑–∞ —Ä–µ—á–∏ –∏–∑ —Ç–µ–∫—Å—Ç–∞.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úçÔ∏è **–í–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞** - —É–¥–æ–±–Ω—ã–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä —Å –ø–æ–¥—Å—á–µ—Ç–æ–º —Å–∏–º–≤–æ–ª–æ–≤
- ‚ö° **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏** - —Å–ª–∞–π–¥–µ—Ä –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏ —Ä–µ—á–∏ (–æ—Ç -50% –¥–æ +100%)
- üéß **–ü—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∞—É–¥–∏–æ–ø–ª–µ–µ—Ä –¥–ª—è –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è –Ω–∞ —Å–∞–π—Ç–µ
- üíæ **–°–∫–∞—á–∏–≤–∞–Ω–∏–µ** - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–∫–∞—á–∞—Ç—å MP3 —Ñ–∞–π–ª
- üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
- üé® **–¢–µ–º–Ω–∞—è —Ç–µ–º–∞** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º–Ω–æ–π/—Å–≤–µ—Ç–ª–æ–π —Ç–µ–º—ã
- üîÑ **–ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤ (–ª–∏–º–∏—Ç 500 MB)

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
cd web_tts

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω FFmpeg
ffmpeg -version
```

### 2. –ó–∞–ø—É—Å–∫

```bash
python main.py
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: **http://localhost:8001**

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ `http://localhost:8001`
2. –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–µ—á–∏ —Å –ø–æ–º–æ—â—å—é —Å–ª–∞–π–¥–µ—Ä–∞
4. –ù–∞–∂–º–∏—Ç–µ "–û–∑–≤—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç"
5. –ü—Ä–æ—Å–ª—É—à–∞–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–ª–∏ —Å–∫–∞—á–∞–π—Ç–µ MP3

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–§–∞–π–ª `main.py` —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

```python
# –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
AUDIO_DIR = "audio"  # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –∞—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤

# –•—Ä–∞–Ω–∏–ª–∏—â–µ
MAX_STORAGE_MB = 500  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

# TTS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
TTS_VOICE = "ru-RU-DmitryNeural"
DEFAULT_RATE = "+50%"
TTS_PITCH = "+0Hz"

# –°–µ—Ä–≤–µ—Ä
HOST = "0.0.0.0"  # 0.0.0.0 –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ —Å –¥—Ä—É–≥–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
PORT = 8001
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Ä—Ç–∞

```python
# –í –∫–æ–Ω—Ü–µ —Ñ–∞–π–ª–∞ main.py
uvicorn.run("main:app", host="0.0.0.0", port=8002, reload=True)
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≥–æ–ª–æ—Å–∞

```python
TTS_VOICE = "ru-RU-SvetlanaNeural"  # –ñ–µ–Ω—Å–∫–∏–π –≥–æ–ª–æ—Å
```

–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä—É—Å—Å–∫–∏–µ –≥–æ–ª–æ—Å–∞:
- `ru-RU-DmitryNeural` (–º—É–∂—Å–∫–æ–π)
- `ru-RU-SvetlanaNeural` (–∂–µ–Ω—Å–∫–∏–π)

## API Endpoints

### `GET /`
–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å —Ñ–æ—Ä–º–æ–π

### `POST /synthesize`
–°–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏ –∏–∑ —Ç–µ–∫—Å—Ç–∞

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `text` (form) - —Ç–µ–∫—Å—Ç –¥–ª—è –æ–∑–≤—É—á–∏–≤–∞–Ω–∏—è
- `rate` (form) - —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–µ—á–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "+50%")

**–û—Ç–≤–µ—Ç:**
```json
{
    "status": "success",
    "file_id": "uuid-here",
    "message": "–ê—É–¥–∏–æ —É—Å–ø–µ—à–Ω–æ —Å–∏–Ω—Ç–µ–∑–∏—Ä–æ–≤–∞–Ω–æ"
}
```

### `GET /audio/{file_id}`
–ü–æ–ª—É—á–µ–Ω–∏–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª–∞

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `file_id` - UUID —Ñ–∞–π–ª–∞

**–û—Ç–≤–µ—Ç:**
MP3 —Ñ–∞–π–ª

### `GET /stats`
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

**–û—Ç–≤–µ—Ç:**
```json
{
    "total_size_mb": 123.45,
    "max_size_mb": 500.0,
    "used_percent": 24.7,
    "file_count": 42,
    "available_mb": 376.55
}
```

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### Systemd Service

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `/etc/systemd/system/tts-web.service`:

```ini
[Unit]
Description=TTS Web Application
After=network.target

[Service]
Type=simple
User=your_user
WorkingDirectory=/path/to/web_tts
Environment="PATH=/path/to/venv/bin"
ExecStart=/path/to/venv/bin/uvicorn main:app --host 0.0.0.0 --port 8001
Restart=always
RestartSec=10
StandardOutput=append:/var/log/tts-web.log
StandardError=append:/var/log/tts-web-error.log

[Install]
WantedBy=multi-user.target
```

**–ê–∫—Ç–∏–≤–∞—Ü–∏—è:**
```bash
sudo systemctl daemon-reload
sudo systemctl enable tts-web
sudo systemctl start tts-web
```

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```bash
# –°—Ç–∞—Ç—É—Å
sudo systemctl status tts-web

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
sudo systemctl restart tts-web

# –õ–æ–≥–∏
sudo journalctl -u tts-web -f
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å Nginx (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ –Ω—É–∂–µ–Ω reverse proxy:

```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://127.0.0.1:8001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –ø–æ IP

–í `main.py` –¥–æ–±–∞–≤—å—Ç–µ middleware:

```python
from fastapi import Request
from starlette.middleware.base import BaseHTTPMiddleware

ALLOWED_IPS = ["127.0.0.1", "your.server.ip"]

class IPWhitelistMiddleware(BaseHTTPMiddleware):
    async def dispatch(self, request: Request, call_next):
        client_ip = request.client.host
        if client_ip not in ALLOWED_IPS:
            return HTMLResponse("Access Denied", status_code=403)
        return await call_next(request)

app.add_middleware(IPWhitelistMiddleware)
```

### –ë–∞–∑–æ–≤–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Nginx basic auth –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ FastAPI middleware.

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —Å–ª–∞–±–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (1GB RAM)

1. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ concurrent –∑–∞–ø—Ä–æ—Å—ã** –≤ `tts_common/tts_service.py`:
```python
TTS_SEMAPHORE = asyncio.Semaphore(5)  # –í–º–µ—Å—Ç–æ 10
```

2. **–£–º–µ–Ω—å—à–∏—Ç–µ –ª–∏–º–∏—Ç —Ö—Ä–∞–Ω–∏–ª–∏—â–∞**:
```python
MAX_STORAGE_MB = 250  # –í–º–µ—Å—Ç–æ 500
```

3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ swap**:
```bash
# –°–æ–∑–¥–∞—Ç—å swap 2GB
sudo fallocate -l 2G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
```

4. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ workers uvicorn**:
```python
uvicorn.run("main:app", host="0.0.0.0", port=8001, workers=1)
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
```bash
# –û–±—â–∞—è –ø–∞–º—è—Ç—å
free -h

# –ü–∞–º—è—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞ Python
ps aux | grep uvicorn
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞–∑–º–µ—Ä–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
```bash
du -sh audio/
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è uvicorn –≤ stdout.

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—Ç
netstat -tulpn | grep 8001

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å debug
python main.py
```

### –û—à–∏–±–∫–∞ 500 –ø—Ä–∏ —Å–∏–Ω—Ç–µ–∑–µ
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ FFmpeg
ffmpeg -version

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
sudo journalctl -u tts-web -n 50

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ
df -h
```

### –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞
- –£–º–µ–Ω—å—à–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ concurrent –∑–∞–ø—Ä–æ—Å–æ–≤ (TTS_SEMAPHORE)
- –£–≤–µ–ª–∏—á—å—Ç–µ RAM —Å–µ—Ä–≤–µ—Ä–∞ –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ swap
- –û—á–∏—Å—Ç–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ –∞—É–¥–∏–æ —Ñ–∞–π–ª—ã

## –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤–æ–π —Å—Ö–µ–º—ã

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `templates/index.html`, —Å–µ–∫—Ü–∏—è `<style>`:

```css
:root {
    --button-bg: #your-color;
    --button-hover: #your-hover-color;
    /* –∏ —Ç.–¥. */
}
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–æ—Ç–∏–ø–∞

```html
<!-- –í –Ω–∞—á–∞–ª–µ body -->
<div class="logo">
    <img src="/static/logo.png" alt="Logo">
</div>
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤

–í—Å–µ —Ç–µ–∫—Å—Ç—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `templates/index.html`.

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **FastAPI** - –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **Uvicorn** - ASGI —Å–µ—Ä–≤–µ—Ä
- **Jinja2** - —à–∞–±–ª–æ–Ω–∏–∑–∞—Ç–æ—Ä
- **edge-tts** - —Å–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏ Microsoft Edge
- **Vanilla JavaScript** - –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License
