# TTS Telegram Bot

Telegram –±–æ—Ç –¥–ª—è –æ–∑–≤—É—á–∏–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞, –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ –≤–µ–±-—Å—Ç–∞—Ç–µ–π.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üìù **–¢–µ–∫—Å—Ç** - –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É —Ç–µ–∫—Å—Ç, –ø–æ–ª—É—á–∏—Ç–µ –æ–∑–≤—É—á–µ–Ω–Ω—ã–π MP3
- üìÑ **–î–æ–∫—É–º–µ–Ω—Ç—ã** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤: txt, docx, pdf, md, rtf, epub, fb2
- üåê **–í–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—ã** - –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Å—Ç–∞—Ç—å—é, –±–æ—Ç –∏–∑–≤–ª–µ—á–µ—Ç –∏ –æ–∑–≤—É—á–∏—Ç —Ç–µ–∫—Å—Ç
- üíæ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤ (–ª–∏–º–∏—Ç 500 MB)
- üìä **–ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤** - –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ SQLite
- üé§ **–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≥–æ–ª–æ—Å** - ru-RU-DmitryNeural, —Å–∫–æ—Ä–æ—Å—Ç—å +50%

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏–ª–∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
cd telegram_bot

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω FFmpeg
ffmpeg -version
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞

–¢–æ–∫–µ–Ω –±–æ—Ç–∞ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ `config.py`. –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å:

```bash
cp .env.example .env
nano .env  # –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω
```

### 3. –ó–∞–ø—É—Å–∫

```bash
python main.py
```

–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω! –ù–∞–π–¥–∏—Ç–µ –µ–≥–æ –≤ Telegram –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`

## –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

- `/start` - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
- `/help` - –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å–ø—Ä–∞–≤–∫–∞ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- `/stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (–æ–±—ä–µ–º, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤)

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –û–∑–≤—É—á–∏–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
–ü—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:
```
–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ —Ç–µ–∫—Å—Ç –¥–ª—è –æ–∑–≤—É—á–∏–≤–∞–Ω–∏—è.
```

–ë–æ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–µ–∫—Å—Ç –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç –≤–∞–º MP3 —Ñ–∞–π–ª.

### –û–∑–≤—É—á–∏–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–∞–π–ª –≤ –æ–¥–Ω–æ–º –∏–∑ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤:
- `.txt` - —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã
- `.docx` - –¥–æ–∫—É–º–µ–Ω—Ç—ã Word
- `.pdf` - PDF –¥–æ–∫—É–º–µ–Ω—Ç—ã
- `.md` - Markdown —Ñ–∞–π–ª—ã
- `.rtf` - Rich Text Format
- `.epub` - —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–µ –∫–Ω–∏–≥–∏
- `.fb2` - FictionBook

–ë–æ—Ç –∏–∑–≤–ª–µ—á–µ—Ç —Ç–µ–∫—Å—Ç –∏ –æ–∑–≤—É—á–∏—Ç –µ–≥–æ.

### –û–∑–≤—É—á–∏–≤–∞–Ω–∏–µ –≤–µ–±-—Å—Ç–∞—Ç—å–∏
–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Å—Ç–∞—Ç—å—é –∏–ª–∏ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—É:
```
https://example.com/article
```

–ë–æ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É, –∏–∑–≤–ª–µ—á–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç –∏ –æ–∑–≤—É—á–∏—Ç –µ–≥–æ.

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–§–∞–π–ª `config.py`:

```python
# Telegram Bot Token
BOT_TOKEN = "–≤–∞—à_—Ç–æ–∫–µ–Ω"

# –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
AUDIO_DIR = "audio"  # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –∞—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤
DB_PATH = "bot_history.db"  # –ü—É—Ç—å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

# TTS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
TTS_VOICE = "ru-RU-DmitryNeural"
TTS_RATE = "+50%"
TTS_PITCH = "+0Hz"

# –•—Ä–∞–Ω–∏–ª–∏—â–µ
MAX_STORAGE_MB = 500  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

# –õ–∏–º–∏—Ç—ã
MAX_TEXT_LENGTH = 50000  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞
MAX_FILE_SIZE_MB = 20    # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
```

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–ë–æ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ SQLite (`bot_history.db`).

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã `requests`:**
- `id` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∑–∞–ø—Ä–æ—Å–∞
- `user_id` - Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `username` - –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `request_type` - —Ç–∏–ø –∑–∞–ø—Ä–æ—Å–∞ ('text', 'document', 'url')
- `content` - —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∑–∞–ø—Ä–æ—Å–∞
- `audio_path` - –ø—É—Ç—å –∫ —Å–æ–∑–¥–∞–Ω–Ω–æ–º—É –∞—É–¥–∏–æ
- `status` - —Å—Ç–∞—Ç—É—Å ('success', 'error')
- `error_message` - —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ (–µ—Å–ª–∏ –µ—Å—Ç—å)
- `created_at` - –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è

### –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏

```bash
sqlite3 bot_history.db "SELECT * FROM requests ORDER BY created_at DESC LIMIT 10;"
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ñ–∞–π–ª `bot.log` –∏ –≤ –∫–æ–Ω—Å–æ–ª—å.

**–£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:**
- INFO - –æ–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- WARNING - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- ERROR - –æ—à–∏–±–∫–∏

**–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:**
```bash
tail -f bot.log
```

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### Systemd Service

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `/etc/systemd/system/tts-bot.service`:

```ini
[Unit]
Description=TTS Telegram Bot
After=network.target

[Service]
Type=simple
User=your_user
WorkingDirectory=/path/to/telegram_bot
Environment="PATH=/path/to/venv/bin"
ExecStart=/path/to/venv/bin/python main.py
Restart=always
RestartSec=10
StandardOutput=append:/var/log/tts-bot.log
StandardError=append:/var/log/tts-bot-error.log

[Install]
WantedBy=multi-user.target
```

**–ê–∫—Ç–∏–≤–∞—Ü–∏—è:**
```bash
sudo systemctl daemon-reload
sudo systemctl enable tts-bot
sudo systemctl start tts-bot
```

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```bash
# –°—Ç–∞—Ç—É—Å
sudo systemctl status tts-bot

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
sudo systemctl restart tts-bot

# –õ–æ–≥–∏
sudo journalctl -u tts-bot -f
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ë–æ—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω
grep BOT_TOKEN config.py

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ FFmpeg
ffmpeg -version
```

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
tail -n 50 bot.log

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å
ps aux | grep "python main.py"

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
sudo systemctl restart tts-bot
```

### –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Å–ø–∏—Å–∫–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–º–∞–∫—Å. 20 MB)
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞

### –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ URL
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ URL –≤–∞–ª–∏–¥–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–∞–π—Ç—ã –º–æ–≥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–æ—Å—Ç—É–ø

## –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

### –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤
–•—Ä–∞–Ω–∏–ª–∏—â–µ –æ—á–∏—â–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –î–ª—è —Ä—É—á–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏:
```bash
rm -rf audio/*
```

### –û—á–∏—Å—Ç–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
# –£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å–∏ —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π
sqlite3 bot_history.db "DELETE FROM requests WHERE created_at < datetime('now', '-30 days');"

# –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ë–î
sqlite3 bot_history.db "VACUUM;"
```

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –ë–î
cp bot_history.db bot_history_backup_$(date +%Y%m%d).db

# –°–æ–∑–¥–∞—Ç—å –∞—Ä—Ö–∏–≤ –∞—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤
tar -czf audio_backup_$(date +%Y%m%d).tar.gz audio/
```

## –°–º–µ–Ω–∞ –≥–æ–ª–æ—Å–∞

–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä—É—Å—Å–∫–∏–µ –≥–æ–ª–æ—Å–∞:
- `ru-RU-DmitryNeural` (–º—É–∂—Å–∫–æ–π, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- `ru-RU-SvetlanaNeural` (–∂–µ–Ω—Å–∫–∏–π)

–ò–∑–º–µ–Ω–∏—Ç–µ –≤ `config.py`:
```python
TTS_VOICE = "ru-RU-SvetlanaNeural"
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **aiogram 3.x** - —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è Telegram Bot
- **SQLAlchemy** - ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- **edge-tts** - —Å–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏ Microsoft Edge
- **trafilatura** - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü
- **pdfplumber** - –ø–∞—Ä—Å–∏–Ω–≥ PDF
- **python-docx** - –ø–∞—Ä—Å–∏–Ω–≥ DOCX
- **EbookLib** - –ø–∞—Ä—Å–∏–Ω–≥ EPUB
- **BeautifulSoup** - –ø–∞—Ä—Å–∏–Ω–≥ HTML/XML

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License
